{% if test_cases != None -%}
{% for case_id, case in test_cases.items() %}
{{ test_info.operationId }}_{{ case_id }}
    [Tags]  RESTful  {{ test_info.method }}  {{ case.test_strategy }}  {{ case.test_type }}  
    [Documentation]  {{ case.summary }}
    {% for point_id, point in case.test_point.items() -%}
        {% for id, setup in point.dependency.Setup.items() %}
    # Setup - {{ case_id }}.{{ point_id }}.{{ id }}
        ${req}  {{ '${' }}{{ setup.response_name }}}=  Run Keyword  ${sender}.send_restful  {{ setup.action }}  {{ setup.object }}
        {% if 'path' in setup -%}
        {% if setup.path != {} -%}
        {% for path_id, path in setup.path.items() -%}
        {% if 'Value' in path -%}
            {% set value = path.Value -%}
        {% else -%}
            {% set value = path -%}
        {% endif -%}
        ...  {{ path_id }}={{ value }}
        {% endfor -%}
        {%- endif %}
        {%- endif %}
        {%- if setup.data_generation_rules != {} -%}
        ...  file_name={{ setup.config_name }}
        {%- endif %}
        {{ '${' }}{{ setup.response_name }}.status_code}=  Convert To String  {{ '${' }}{{ setup.response_name }}.status_code}
        Run Keyword If  {{ '${' }}{{ setup.response_name }}.status_code} != 200  Log  {{ '${' }}{{ setup.response_name }}.content}
        Should Be Equal  {{ '${' }}{{ setup.response_name }}.status_code}  200
        {% endfor %}
    # Test - {{ case_id }}.{{ point_id }}
        # {{ case.summary }}
        ${req}  ${resp}=  Run Keyword  ${sender}.send_restful  {{ test_info.action }}  {{ test_info.object }}
        {%- if point.parameter.testdata != None %}
        ...  file_name={{ point.parameter.testdata }}
        {% endif -%}
        {%- if point.path != {} -%}
        ...  {% for path_id, path in point.path.items() -%}{{ path_id }}={{ path }}   {% endfor -%}
        {% endif %}
        ${parsed_resp}=  Parser.api_parser  ${resp}
        Log  ${parsed_resp}
        {% for assertion_id, assertion in point.assertion.items() %}
        {% if assertion.source == 'Status Code' -%}
        ${resp.status_code}=  Convert To String  ${resp.status_code}
        Run Keyword If  ${resp.status_code} != {{ assertion.expected_value }}  Log  ${resp.content}
        {{ assertion.assertion_method }}  ${resp.status_code}  {{ assertion.expected_value }}
        {% elif assertion.source == 'Body' -%}
            {% if assertion.filter_expression != '' -%}
            ${filterd_result}=  ReturnParser.api_parser  ${resp}  {{ assertion.filter_expression }}
            Log  ${filterd_result}
            {{ assertion.assertion_method }}  ${filterd_result}  {{ assertion.expected_value }}
            {% else -%}
            {{ assertion.assertion_method }}  ${parsed_resp}  {{ assertion.expected_value }}
            {% endif -%}
        {{ assertion.assertion_method }}  ${parsed_resp}  {{ assertion.expected_value }}
        {% elif assertion.source == 'Header' -%}
        {{ assertion.assertion_method }}  ${resp.headers}  {{ assertion.expected_value }}
        {% endif -%}
        {% endfor -%}
        {% for id, teardown in point.dependency.Teardown.items() %}
    # Teardown - {{ case_id }}.{{ point_id }}.{{ id }}
        {{ '${' }}req{{ id }}}  {{ '${' }}{{ teardown.response_name }}}=  Run Keyword  ${sender}.send_restful  {{ teardown.action }}  {{ teardown.object }}
        {% if 'path' in teardown -%}
        {% if teardown.path != {} -%}
        {% for path_id, path in teardown.path.items() -%}
        {% if 'Value' in path -%}
            {% set value = path.Value -%}
        {% else -%}
            {% set value = path -%}
        {% endif -%}
        ...  {{ path_id }}={{ value }}  
        {% endfor -%}
        {%- endif %}
        {%- endif %}
        {%- if teardown.data_generation_rules != {} -%}
        ...  file_name={{ teardown.config_name }}
        {%- endif %}
        {{ '${' }}{{ teardown.response_name }}.status_code}=  Convert To String  {{ '${' }}{{ teardown.response_name }}.status_code}
        Run Keyword If  {{ '${' }}{{ teardown.response_name }}.status_code} != 200  Log  {{ '${' }}{{ teardown.response_name }}.content}
        Should Be Equal  {{ '${' }}{{ teardown.response_name }}.status_code}  200
        {% endfor -%}
    {% endfor -%}
{% endfor -%}
{% endif %}